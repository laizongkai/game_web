import{d as E,r as u,o as B,c as I,a as n,b as t,w as h,v as b,F as v,g,l as j,t as i,m as r}from"./index-CMFezg7R.js";import{p as D}from"./selling-HnLADzzT.js";const M={id:"view_body"},N={class:"selling-body",style:{width:"90%",height:"90%"}},O={style:{width:"50%",height:"100%",position:"relative"}},P={id:"product-list"},J={class:"search-body"},K={class:"search-component",style:{height:"60px",display:"flex","flex-direction":"row"}},L={class:"product-table-sticky-wrapper"},T={class:"table table-hover"},q={class:"product-table-thead"},z={class:"text-center",scope:"col",style:{"font-weight":"bolder","background-color":"rgb(120,180,200)"}},A={class:"product-table-tbody"},G={style:{height:"40px"}},H={class:"align-middle text-center",scope:"row"},Q={class:"align-middle text-center",style:{width:"10%"}},R={class:"align-middle text-center",style:{width:"20%"}},W={class:"align-middle text-center",style:{width:"40%"}},X={class:"align-middle text-center",style:{width:"15%"}},Y=["onClick"],Z={key:1,class:"btn btn-success table-btn",disabled:""},ee={style:{width:"45%"}},te={class:"selling-table-sticky-wrapper"},le={class:"table table-hover"},se={class:"product-table-thead"},oe={class:"text-center selling-table-thead",scope:"col",style:{"font-weight":"bolder","background-color":"rgb(42, 212, 189)"}},ae={class:"product-table-tbody"},ne={class:"align-middle text-center",scope:"row"},re={class:"align-middle text-center",style:{width:"40%"}},de=["onUpdate:modelValue"],ce={class:"align-middle text-center",style:{width:"15%"}},ie=["onUpdate:modelValue"],ue={class:"align-middle text-center",style:{width:"15%"}},_e=["onUpdate:modelValue"],pe={class:"align-middle text-center",style:{width:"15%"}},he=["onClick"],me=E({__name:"SellingView",setup(be){const _=u([]),m=u(""),f=["#","平台","商品類型","商品名稱","操作"],y=["#","商品名稱","售出價格","數量","操作"],p=u(""),d=u({id:"",name:"",platformer:"",production_used:"",type:"",purchase_price:0,real_selling_price:0,sell_count:0,count:0}),o=u([]),w=s=>{let l=!1;for(let e=0;e<o.value.length;e++)if(o.value[e].name==s){l=!0;break}return l},x=s=>{w(s.name)!=!0&&(d.value.id=s.id,d.value.name=s.name,d.value.platformer=s.platformer,d.value.production_used=s.production_used,d.value.type=s.type,d.value.purchase_price=s.purchase_price,d.value.count=s.count,o.value.push({...d.value}))},k=s=>{o.value.splice(s,1)},C=async()=>{if(V()==!1){window.alert("有價格或數量有未輸入");return}else{let l={selling_list:JSON.stringify(o.value)};const{product:e,message:a}=await D(l);a.value=="OK"?(U(e),window.alert("新增成功")):a.value=="Error Count"?window.alert(`該產品數量超過資料庫儲存數量：${e.value}`):a.value=="Error Selling Count"?window.alert(`該產品銷售數量錯誤：${e.value}`):a.value=="Error Selling Price"?window.alert(`該產品銷售價格錯誤：${e.value}`):window.alert("系統後端出錯")}},V=()=>{let s=!0;for(let l=0;l<o.value.length;l++)if(o.value[l].sell_count==0||o.value[l].real_selling_price==0){s=!1;break}return s},U=s=>{for(let l=0;l<s.value.length;l++)for(let e=0;e<o.value.length;e++)if(o.value[e].id==s.value[l].id){o.value.splice(e,1);break}};async function S(){const{products:s,message:l,error:e}=await j();_.value=s.value,m.value=l.value}const F=async()=>{await S()};B(()=>{F()});const $=I(()=>{let s=[],l=!1;for(let e=0;e<_.value.length;e++)l=!1,p.value!=""?_.value[e].name.search(p.value)!=-1&&(l=!0):l=!0,l==!0&&s.push(_.value[e]);return s});return(s,l)=>(r(),n("div",M,[t("div",N,[t("div",O,[t("div",P,[t("div",J,[t("div",K,[l[1]||(l[1]=t("label",{class:"input-label"}," 商品名稱： ",-1)),h(t("input",{class:"form-control",style:{width:"70%"},"onUpdate:modelValue":l[0]||(l[0]=e=>p.value=e)},null,512),[[b,p.value]])]),l[2]||(l[2]=t("hr",null,null,-1))]),t("div",L,[t("table",T,[t("thead",q,[t("tr",null,[(r(),n(v,null,g(f,e=>t("th",z,i(e),1)),64))])]),t("tbody",A,[(r(!0),n(v,null,g($.value,(e,a)=>(r(),n("tr",G,[t("td",H,i(a+1),1),t("td",Q,i(e.platformer),1),t("td",R,i(e.type),1),t("td",W,i(e.name),1),t("td",X,[e.count>0?(r(),n("button",{key:0,class:"btn btn-success table-btn",onClick:c=>x(e)}," 匯入 ",8,Y)):(r(),n("button",Z," 匯入 "))])]))),256))])])])])]),t("div",ee,[l[3]||(l[3]=t("h4",null,"售出商品 ",-1)),t("div",te,[t("table",le,[t("thead",se,[t("tr",null,[(r(),n(v,null,g(y,e=>t("th",oe,i(e),1)),64))])]),t("tbody",ae,[(r(!0),n(v,null,g(o.value,(e,a)=>(r(),n("tr",null,[t("th",ne,i(a+1),1),t("td",re,[h(t("input",{class:"form-control",id:"exampleFormControlInput1","onUpdate:modelValue":c=>e.name=c,disabled:""},null,8,de),[[b,e.name]])]),t("td",ce,[h(t("input",{class:"form-control",id:"exampleFormControlInput1","onUpdate:modelValue":c=>e.real_selling_price=c,placeholder:"1790"},null,8,ie),[[b,e.real_selling_price]])]),t("td",ue,[h(t("input",{class:"form-control",id:"exampleFormControlInput1","onUpdate:modelValue":c=>e.sell_count=c,placeholder:"1"},null,8,_e),[[b,e.sell_count]])]),t("td",pe,[t("button",{class:"btn btn-danger table-btn",onClick:c=>k(a)}," 刪除 ",8,he)])]))),256))])])]),t("button",{class:"btn btn-primary",style:{height:"40px",width:"120px"},onClick:C}," 送出 ")])])]))}});export{me as default};
